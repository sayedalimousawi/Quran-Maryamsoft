<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‚Ø±Ø¢Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet" />
  <script language="javascript" src="Quran.js"></script>
  <script language="javascript" src="QuranTG.js"></script>
  <script language="javascript" src="Sure.js"></script>
  <style>
    :root {
      --bg: linear-gradient(135deg, #e8fff3, #d2ffec);
      --card: #f5fff7;
      --accent: #16a34a;
      --accent-2: #0ea5e9;
      --muted: #3b5041;
      --border: rgba(7, 65, 35, 0.15);
      --text: #063321;
      --shadow: 0 20px 60px -22px rgba(6, 51, 33, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Vazirmatn', 'Tahoma', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 32px 16px 48px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -20% 0 auto 0;
      height: 380px;
      background: radial-gradient(circle at 15% 20%, rgba(52, 211, 153, 0.35), transparent 36%),
        radial-gradient(circle at 80% 0%, rgba(14, 165, 233, 0.26), transparent 32%);
      filter: blur(20px);
      opacity: 0.8;
      pointer-events: none;
    }

    .page {
      width: min(1200px, 100%);
      display: grid;
      gap: 18px;
      position: relative;
      z-index: 1;
    }

    header { display: grid; gap: 6px; }
    .title { font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -0.5px; }
    .subtitle { margin: 0; color: var(--muted); line-height: 1.7; }

    .meta-bar { display: flex; gap: 10px; flex-wrap: wrap; }
    .meta-chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 12px; background: #e8fff1; border: 1px solid var(--border); color: var(--muted); font-size: 14px; }

    .section-title { margin: 0 0 6px; font-weight: 800; color: #064e3b; letter-spacing: -0.2px; }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 20px;
      box-shadow: var(--shadow);
    }

    label { display: block; font-weight: 700; margin-bottom: 8px; color: #0f5132; }

    textarea, select, input[type='number'] {
      width: 100%;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.9);
      color: var(--text);
      padding: 14px;
      font-size: 18px;
      resize: vertical;
      font-family: 'wm_Naskh Qurani 93', 'Vazirmatn', sans-serif;
      transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    textarea:focus, select:focus, input[type='number']:focus {
      outline: none;
      border-color: rgba(22, 163, 74, 0.6);
      box-shadow: 0 0 0 4px rgba(22, 163, 74, 0.2);
      background: #ffffff;
    }

    textarea { min-height: 120px; }

    .actions { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-top: 14px; }

    button {
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #052e16;
      font-weight: 800;
      padding: 12px 18px;
      cursor: pointer;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 12px 25px -12px rgba(34, 197, 94, 0.65);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.2s ease;
    }

    button:hover { transform: translateY(-1px); filter: brightness(1.05); }
    button:active { transform: translateY(0); box-shadow: 0 8px 18px -10px rgba(34, 197, 94, 0.55); }

    .secondary { background: #e8fff1; color: #0f5132; box-shadow: none; border: 1px solid var(--border); }
    .ghost { background: transparent; color: #0f5132; border: 1px dashed var(--border); box-shadow: none; }

    .status { color: var(--muted); font-size: 14px; }
    .status strong { color: var(--accent); }

    .results-wrapper { display: grid; gap: 12px; }

    .results { display: grid; gap: 12px; max-height: 520px; overflow: auto; padding: 6px 2px; }

    .result-card {
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      display: grid;
      gap: 10px;
    }

    .badge { display: inline-flex; align-items: center; justify-content: center; min-width: 42px; height: 42px; border-radius: 12px; background: rgba(22, 163, 74, 0.14); color: #166534; font-weight: 800; font-size: 18px; }

    .ayah { margin: 0; font-size: 24px; line-height: 1.8; font-family: 'wm_Naskh Qurani 93', 'Vazirmatn', sans-serif; color: #052e16; }
    .meta { margin: 0; color: var(--muted); font-size: 14px; }

    .highlight { background: rgba(74, 222, 128, 0.25); border-bottom: 2px solid rgba(34, 197, 94, 0.9); padding: 1px 4px; border-radius: 6px; }

    .controls-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .control { display: grid; gap: 8px; }

    .hint-list { display: grid; gap: 10px; margin: 0; padding: 0; list-style: none; color: var(--muted); }
    .hint-item { display: grid; gap: 4px; padding: 12px 14px; border-radius: 12px; background: rgba(255, 255, 255, 0.88); border: 1px dashed var(--border); }
    .hint-title { font-weight: 800; color: #064e3b; margin: 0; }
    .hint-text { margin: 0; }

    .empty-state { text-align: center; padding: 32px 16px; border: 1px dashed var(--border); border-radius: 16px; color: var(--muted); background: rgba(255, 255, 255, 0.9); }
    .empty-state strong { color: var(--accent); }

    .result-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .mini { font-size: 14px; padding: 8px 10px; }

    .context-box { border: 1px solid var(--border); border-radius: 12px; background: #f1fff7; padding: 12px; display: grid; gap: 6px; }
    .context-line { display: flex; align-items: baseline; gap: 8px; font-size: 16px; color: #0f5132; }
    .context-line.current { background: #dfffee; border-radius: 8px; padding: 6px; font-weight: 700; }
    .context-line .ayah-meta { color: #166534; font-weight: 700; }

    .range-preview { border: 1px solid var(--border); border-radius: 12px; padding: 12px; background: #ffffff; display: grid; gap: 6px; max-height: 260px; overflow: auto; }
    .range-line { display: flex; gap: 10px; align-items: baseline; }
    .range-line .ayah-meta { color: #0f5132; font-weight: 700; min-width: 66px; }
    .range-line .ayah-text { font-size: 20px; line-height: 1.7; }

    .navigator { border: 1px solid var(--border); border-radius: 14px; background: #ffffff; padding: 12px; max-height: 340px; overflow: auto; display: grid; gap: 8px; }
    .nav-sure-title { font-weight: 800; color: #064e3b; padding: 6px 10px; background: #e8fff1; border-radius: 10px; border: 1px solid var(--border); }
    .nav-line { display: flex; gap: 10px; align-items: baseline; padding: 6px 10px; border-radius: 10px; }
    .nav-line:nth-child(even) { background: #f8fff9; }
    .nav-line .nav-number { color: #166534; font-weight: 700; min-width: 42px; }
    .nav-line .nav-text { font-size: 18px; line-height: 1.6; }
    .nav-line.bismillah { background: #e0ffef; border: 1px solid rgba(22, 163, 74, 0.2); }

    .flex-between { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
    .small-note { color: var(--muted); font-size: 13px; }

    @media (max-width: 768px) {
      body { padding: 20px 12px 32px; }
      .title { font-size: 26px; }
      textarea { font-size: 20px; }
      .ayah { font-size: 22px; }
      .actions { flex-direction: column; align-items: flex-start; }
      .result-actions { width: 100%; }
      .mini { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <p class="title">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù‚Ø±Ø¢Ù†</p>
      <p class="subtitle">Ø¹Ø¨Ø§Ø±Øª ÛŒØ§ ÙˆØ§Ú˜Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ØªØ§ Ø¢ÛŒØ§Øª Ù…Ø±ØªØ¨Ø· Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù¾ÛŒ Ùˆ Ù…Ø±ÙˆØ± Ø³Ø±ÛŒØ¹ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</p>
      <div class="meta-bar">
        <span class="meta-chip">âš¡ Ø³Ø±Ø¹Øª Ù†Ù…Ø§ÛŒØ´ ÙÙˆØ±ÛŒ Ù†ØªØ§ÛŒØ¬</span>
        <span class="meta-chip">âœ¨ Ø¨Ø±Ø¬Ø³ØªÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ø¨Ø§Ø±Øª Ùˆ Ø²Ù…ÛŒÙ†Ù‡</span>
        <span class="meta-chip">ğŸŒ¿ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ´Ù† Ùˆ Ø´Ø§Ø¯</span>
      </div>
    </header>

    <section class="card">
      <p class="section-title">Ø¬Ø³ØªØ¬Ùˆ</p>
      <label for="oStrSearch">Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ø¬Ø³ØªØ¬Ùˆ</label>
      <textarea id="oStrSearch" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÛŒÙ…" aria-label="Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ø¬Ø³ØªØ¬Ùˆ" onkeydown="handleKeydown(event)"></textarea>
      <div class="actions">
        <div style="display:flex; gap:10px; flex-wrap: wrap;">
          <button type="button" onclick="SmartSearch()" aria-label="Ø¬Ø³ØªØ¬Ùˆ">
            <span>ğŸ”</span>
            <span>Ø¬Ø³ØªØ¬Ùˆ</span>
          </button>
          <button type="button" class="secondary" onclick="clearResults()" aria-label="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†">
            <span>ğŸ§¹</span>
            <span>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</span>
          </button>
        </div>
        <div class="flex-between" style="gap: 12px;">
          <div class="small-note">ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØ§Øª Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯ Ø¯Ø± Ù†ØªØ§ÛŒØ¬</div>
          <input type="range" min="0" max="5" value="1" id="contextRadius" oninput="updateContextLabel()" />
          <span class="badge" id="contextLabel">Û±</span>
        </div>
        <span id="resultMeta" class="status" aria-live="polite">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¹Ø¨Ø§Ø±Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</span>
      </div>
    </section>

    <section class="card results-wrapper">
      <p class="section-title">Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ</p>
      <div class="results" id="oResult" aria-live="polite"></div>
    </section>

    <section class="card">
      <div class="flex-between">
        <p class="section-title">Ù†Ù…Ø§ÛŒØ´ Ùˆ Ú©Ù¾ÛŒ Ø¨Ø§Ø²Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø¢ÛŒØ§Øª</p>
        <span id="rangeMeta" class="small-note"></span>
      </div>
      <div class="controls-grid">
        <div class="control">
          <label for="rangeSure">Ø§Ù†ØªØ®Ø§Ø¨ Ø³ÙˆØ±Ù‡</label>
          <select id="rangeSure" onchange="updateRangeLimits()"></select>
        </div>
        <div class="control">
          <label for="rangeStart">Ø§Ø² Ø¢ÛŒÙ‡</label>
          <input type="number" id="rangeStart" min="1" value="1" oninput="renderRange()" />
        </div>
        <div class="control">
          <label for="rangeEnd">ØªØ§ Ø¢ÛŒÙ‡</label>
          <input type="number" id="rangeEnd" min="1" value="1" oninput="renderRange()" />
        </div>
        <div class="control" style="align-self: end;">
          <div class="result-actions">
            <button class="mini" onclick="renderRange()">Ù†Ù…Ø§ÛŒØ´</button>
            <button class="mini secondary" onclick="copyRange()">Ú©Ù¾ÛŒ Ø¨Ø§Ø²Ù‡</button>
          </div>
        </div>
      </div>
      <div class="range-preview" id="rangePreview"></div>
    </section>

    <section class="card">
      <div class="flex-between">
        <p class="section-title">Ù†ÙˆÛŒÚ¯ÛŒØªÙˆØ± Ú©Ø§Ù…Ù„ Ù‚Ø±Ø¢Ù†</p>
        <span class="small-note">Ø¯Ø± Ù‡Ø± Ø³Ø·Ø± ÛŒÚ© Ø¢ÛŒÙ‡Ø› Ø¹Ù†ÙˆØ§Ù† Ø³ÙˆØ±Ù‡ Ùˆ Â«Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÛŒÙ…Â» Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.</span>
      </div>
      <div class="navigator" id="navigatorList"></div>
    </section>

    <section class="card" style="background: rgba(255,255,255,0.85);">
      <p class="section-title">Ø±Ø§Ù‡Ù†Ù…Ø§</p>
      <ul class="hint-list">
        <li class="hint-item">
          <p class="hint-title">Ú©Ù¾ÛŒ Ø³Ø±ÛŒØ¹ Ù†ØªØ§ÛŒØ¬</p>
          <p class="hint-text">Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ØªÛŒØ¬Ù‡ØŒ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ø¢ÛŒÙ‡ Ùˆ Ú©Ù¾ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø¢ÛŒØ§Øª Ù‚Ø¨Ù„ Ùˆ Ø¨Ø¹Ø¯ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª.</p>
        </li>
        <li class="hint-item">
          <p class="hint-title">Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ù„Ø®ÙˆØ§Ù‡</p>
          <p class="hint-text">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÛŒÚ© Ø³ÙˆØ±Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ø§Ø² Ø¢ÛŒÙ‡â€ŒØ§ÛŒ Ø¨Ù‡ Ø¢ÛŒÙ‡ Ø¯ÛŒÚ¯Ø± Ù†Ù…Ø§ÛŒØ´ Ùˆ Ú©Ù¾ÛŒ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
        </li>
        <li class="hint-item">
          <p class="hint-title">Ù…Ø±ÙˆØ± ÛŒÚ©â€ŒØ¬Ø§</p>
          <p class="hint-text">Ù†ÙˆÛŒÚ¯ÛŒØªÙˆØ± Ù¾Ø§ÛŒÛŒÙ†ÛŒ ØªÙ…Ø§Ù… Ù‚Ø±Ø¢Ù† Ø±Ø§ Ø¨Ø§ Ø¹Ù†ÙˆØ§Ù† Ø³ÙˆØ±Ù‡ Ùˆ Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø¯Ø± ÛŒÚ© Ø³Ø·Ø± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
        </li>
      </ul>
    </section>
  </main>

  <script language="javascript">
  //-------------------------------------------------------
  mFatheh=Char(1614)
  mKasreh=Char(1616)
  mZameh=Char(1615)
  mFathatan=Char(1611)
  mKasratan=Char(1613)
  mZamatan=Char(1612)
  mTashdid=Char(1617)
  mSaken=Char(1618)
  mZero=Char(1760)
  mMad=Char(1619)
  mTalef=Char(1648)
  mBalef=Char(1622)
  mMim=Char(1762)
  mYeheshba=Char(1767)

  vqfSala=Char(1750)
  vqfQala=Char(1751)
  vqfJim=Char(1754)
  vqfMim=Char(1752)
  vqfSin=Char(1756)
  vqf3Point=Char(1755)

  chSpace=Char(32)
  chKashideh=Char(1600)
  chHmz=Char(1569)
  chAlf=Char(1575)
  chYeh_HMZ=Char(1574)
  chAlf_THMZ=Char(1571)
  chAlf_BHMZ=Char(1573)
  chAlf_TVSL=Char(1649)
  chDal=Char(1583)
  chLam=Char(1604)
  chMim=Char(1605)
  chNun=Char(1606)
  chVav=Char(1608)
  chHeh=Char(1607)
  chYeh=Char(1740)
  chYeh_B2P=Char(1610)
  chMaq=Char(1609)
  chYeheshba=Char(1766)
  chVaveshba=Char(1765)
  //-------------------------------------------------------
  function Char(ch)
  {
          if( ch.toString(16).length==2 ) return unescape("%u00"+ch.toString(16))
          if( ch.toString(16).length==3 ) return unescape("%u0"+ch.toString(16))
          return unescape("%u"+ch.toString(16))
  }
  //-------------------------------------------------------
  function Strip(str,chars)
  {
          newstr=""
          for(i=0;i<str.length;i++)
          {
                  if(chars.indexOf(str.charAt(i))==-1) newstr+=str.charAt(i)
          }
          return newstr
  }
  //-------------------------------------------------------
  function GenerateData(Text)
  {
          var sure=Text.split(" + ");
          for(var i=0;i<sure.length;i++)
          {
                  var ayat=sure[i].split(" - ");
                  sure[i]=ayat;
          }
          return sure;
  }
  //-------------------------------------------------------
  function ReplaceAll(str,strFind,strReplace)
  {
          re=new RegExp(strFind,"g")
          return str.replace(re,strReplace)
  }
  //-------------------------------------------------------
  function RemoveMarks(str)
  {
          var erab=mFatheh+mKasreh+mZameh+mFathatan+mKasratan+mZamatan+mTashdid+mSaken+mZero+mMad+mTalef+mBalef+mMim+mYeheshba+vqfSala+vqfQala+vqfJim+vqfMim+vqfSin+vqf3Point;
          for(var i=0;i<erab.length;i++)
          {
                  str=ReplaceAll(str,erab.charAt(i),"");
          }
          return str;
  }
  //-------------------------------------------------------
  function RemoveChars(str)
  {
          var C=ccA+ccK+ccX+ccNX+ccY+ccNY+ccTMX+ccTMNX+ccTMY+ccTMNY+ccBMX+ccBMNX+ccBMY+ccBMNY+ccZWNJ+pT1P+pT2P+pT3P+pB1P+pB2P+pB3P+pTAA+pTVSL+pTHMZ+pBHMZ+mFatheh+mKasreh+mZameh+mFathatan+mKasratan+mZamatan+mTashdid+mSaken+mZero+mMad+mTalef+mBalef+mMim+mYeheshba+vqfSala+vqfQala+vqfJim+vqfMim+vqfSin+vqf3Point;
          for(var i=0;i<C.length;i++)
          {
                  str=ReplaceAll(str,C.charAt(i),"");
          }
          return str;
  }
  //-------------------------------------------------------
  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
  //-------------------------------------------------------
  function highlightMatch(text, query) {
    if (!query) return text;
    try {
      var regex = new RegExp(escapeRegExp(query), 'gi');
      return text.replace(regex, function(match) {
        return '<span class="highlight">' + match + '</span>';
      });
    } catch (e) {
      return text;
    }
  }
  //-------------------------------------------------------
  function renderEmptyState(message){
    return "<div class='empty-state'>"+message+"</div>";
  }
  //-------------------------------------------------------
  function handleKeydown(event){
    if(event.key==='Enter' && (event.ctrlKey || event.metaKey || !event.shiftKey)){
      event.preventDefault();
      SmartSearch();
    }
  }
  //-------------------------------------------------------
  function clearResults(){
    oStrSearch.value='';
    oResult.innerHTML=renderEmptyState('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¹Ø¨Ø§Ø±Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
    document.getElementById('resultMeta').innerHTML='Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø¹Ø¨Ø§Ø±Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.';
    oStrSearch.focus();
  }
  //-------------------------------------------------------
  function Copy(Text)
  {
          if(navigator.clipboard && navigator.clipboard.writeText){
            navigator.clipboard.writeText(Text);
          } else {
            window.clipboardData.setData("Text",Text)
          }
  }
  //-------------------------------------------------------
  function getSureName(index){
    var s = Sure[index];
    if(Array.isArray(s)) return s[0];
    return s;
  }
  //-------------------------------------------------------
  function buildContextText(sureIndex, ayahIndex, radius){
    var start=Math.max(0, ayahIndex-radius);
    var end=Math.min(QuranTG[sureIndex].length-1, ayahIndex+radius);
    var parts=[];
    for(var k=start;k<=end;k++){
      parts.push('Ø³ÙˆØ±Ù‡ '+getSureName(sureIndex)+' | Ø¢ÛŒÙ‡ '+(k+1)+'\n'+QuranTG[sureIndex][k]);
    }
    return parts.join('\n');
  }
  //-------------------------------------------------------
  function buildContextBlock(sureIndex, ayahIndex, radius){
    if(radius===0) return '';
    var start=Math.max(0, ayahIndex-radius);
    var end=Math.min(QuranTG[sureIndex].length-1, ayahIndex+radius);
    var lines=[];
    for(var k=start;k<=end;k++){
      var cls='context-line'+(k===ayahIndex?' current':'');
      lines.push('<div class="'+cls+'"><span class="ayah-meta">Ø¢ÛŒÙ‡ '+(k+1)+'</span><span class="ayah-text">'+QuranTG[sureIndex][k]+'</span></div>');
    }
    return '<div class="context-box">'+lines.join('')+'</div>';
  }
  //-------------------------------------------------------
  function SmartSearch()
  {
          var inputValue=oStrSearch.value.trim().replace(/\s+/g,' ');
          if(!inputValue){
            clearResults();
            return;
          }
          var sFind=RemoveMarks(inputValue);
          sFind=ReplaceAll(sFind,"ÙŠ","ÛŒ"); // yeh Farsi
          sFind=ReplaceAll(sFind,"Ú©","Ùƒ"); // Kaf Arab
          count=0
          var fragments=[];
          var contextRadius=parseInt(document.getElementById('contextRadius').value,10) || 0;
          for(var i=0;i<Quran.length;i++)
          {
                  for(var j=0;j<Quran[i].length;j++)
                  {
                          var strAye=RemoveMarks(Quran[i][j]);
                          if( strAye.indexOf(sFind)!=-1 )
                          {
                                  count++;
                                  var ayahHighlighted=highlightMatch(QuranTG[i][j], sFind);
                                  var sureName=getSureName(i);
                                  var contextHtml=buildContextBlock(i,j,contextRadius);
                                  fragments.push(
                                    "<article class='result-card'>"+
                                    "<div style='display:flex; gap:10px; align-items:center;'><span class='badge'>"+count+"</span>"+
                                    "<div><p class='ayah'>"+ayahHighlighted+"</p><p class='meta'>Ø³ÙˆØ±Ù‡ " + sureName + " â€” Ø¢ÛŒÙ‡ " + (j+1) + "</p></div></div>"+
                                    "<div class='result-actions'>"+
                                      "<button type='button' class='mini' onclick='copyAyah("+i+","+j+")'>ğŸ“‹ Ú©Ù¾ÛŒ Ø¢ÛŒÙ‡</button>"+
                                      "<button type='button' class='mini secondary' onclick='copyAyahWithContext("+i+","+j+")'>ğŸ“„ Ú©Ù¾ÛŒ Ù‡Ù…Ø±Ø§Ù‡ Ø²Ù…ÛŒÙ†Ù‡</button>"+
                                    "</div>"+
                                    contextHtml+
                                    "</article>"
                                  );
                          }
                  }
          }
          var meta=document.getElementById('resultMeta');
          if(count===0){
            oResult.innerHTML = renderEmptyState('Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. <strong>Ù„Ø·ÙØ§Ù‹</strong> Ú©Ù„Ù…Ù‡ ÛŒØ§ ØªØ±Ú©ÛŒØ¨ Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.');
            meta.innerHTML='Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. <strong>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¬Ø¯ÛŒØ¯</strong> Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.';
          } else {
            oResult.innerHTML = fragments.join('');
            meta.innerHTML=''+count+' Ù†ØªÛŒØ¬Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯ Ø¨Ø±Ø§ÛŒ <strong>"'+inputValue+'"</strong>.';
          }
  }
  //-------------------------------------------------------
  function copyAyah(sureIndex, ayahIndex){
    Copy(QuranTG[sureIndex][ayahIndex]);
  }
  //-------------------------------------------------------
  function copyAyahWithContext(sureIndex, ayahIndex){
    var radius=parseInt(document.getElementById('contextRadius').value,10) || 0;
    Copy(buildContextText(sureIndex, ayahIndex, radius));
  }
  //-------------------------------------------------------
  function updateContextLabel(){
    var ctx=parseInt(document.getElementById('contextRadius').value,10) || 0;
    document.getElementById('contextLabel').innerText=ctx.toLocaleString('fa-IR');
  }
  //-------------------------------------------------------
  function populateSureSelect(){
    var select=document.getElementById('rangeSure');
    select.innerHTML='';
    for(var i=0;i<Sure.length;i++){
      var option=document.createElement('option');
      option.value=i;
      option.text=getSureName(i);
      select.add(option);
    }
  }
  //-------------------------------------------------------
  function updateRangeLimits(){
    var sureIndex=parseInt(document.getElementById('rangeSure').value,10) || 0;
    var ayahCount=QuranTG[sureIndex].length;
    var startInput=document.getElementById('rangeStart');
    var endInput=document.getElementById('rangeEnd');
    startInput.max=endInput.max=ayahCount;
    if(parseInt(startInput.value,10)<1) startInput.value=1;
    if(parseInt(endInput.value,10)<1) endInput.value=ayahCount;
    if(parseInt(startInput.value,10)>ayahCount) startInput.value=ayahCount;
    if(parseInt(endInput.value,10)>ayahCount) endInput.value=ayahCount;
    if(parseInt(endInput.value,10)<parseInt(startInput.value,10)) endInput.value=startInput.value;
    document.getElementById('rangeMeta').innerText='Ø§ÛŒÙ† Ø³ÙˆØ±Ù‡ '+ayahCount+' Ø¢ÛŒÙ‡ Ø¯Ø§Ø±Ø¯.';
    renderRange();
  }
  //-------------------------------------------------------
  function renderRange(){
    var sureIndex=parseInt(document.getElementById('rangeSure').value,10) || 0;
    var start=parseInt(document.getElementById('rangeStart').value,10) || 1;
    var end=parseInt(document.getElementById('rangeEnd').value,10) || start;
    if(start<1) start=1;
    if(end<start) end=start;
    var ayahCount=QuranTG[sureIndex].length;
    if(start>ayahCount) start=ayahCount;
    if(end>ayahCount) end=ayahCount;
    document.getElementById('rangeStart').value=start;
    document.getElementById('rangeEnd').value=end;
    var lines=[];
    for(var a=start-1; a<end; a++){
      lines.push("<div class='range-line'><span class='ayah-meta'>Ø¢ÛŒÙ‡ "+(a+1)+"</span><span class='ayah-text'>"+QuranTG[sureIndex][a]+"</span></div>");
    }
    document.getElementById('rangePreview').innerHTML=lines.join('');
  }
  //-------------------------------------------------------
  function copyRange(){
    var sureIndex=parseInt(document.getElementById('rangeSure').value,10) || 0;
    var start=parseInt(document.getElementById('rangeStart').value,10) || 1;
    var end=parseInt(document.getElementById('rangeEnd').value,10) || start;
    var parts=['Ø³ÙˆØ±Ù‡ '+getSureName(sureIndex)];
    for(var a=start-1; a<end; a++){
      parts.push('Ø¢ÛŒÙ‡ '+(a+1)+'\n'+QuranTG[sureIndex][a]);
    }
    Copy(parts.join('\n'));
  }
  //-------------------------------------------------------
  function renderNavigator(){
    var holder=document.getElementById('navigatorList');
    var fragments=[];
    for(var i=0;i<QuranTG.length;i++){
      fragments.push('<div class="nav-sure-title">Ø³ÙˆØ±Ù‡ '+getSureName(i)+'</div>');
      for(var j=0;j<QuranTG[i].length;j++){
        var cls='nav-line'+(j===0 && QuranTG[i][j].indexOf('Ø¨Ø³Ù…')!==-1 ? ' bismillah' : '');
        fragments.push('<div class="'+cls+'"><span class="nav-number">'+(j+1)+'</span><span class="nav-text">'+QuranTG[i][j]+'</span></div>');
      }
    }
    holder.innerHTML=fragments.join('');
  }
  //-------------------------------------------------------
  var Quran=GenerateData(QuranText);
  var QuranTG=GenerateData(QuranTextTG);
  var Sure=GenerateData(SureText);

  updateContextLabel();
  populateSureSelect();
  updateRangeLimits();
  renderNavigator();
  clearResults();

  </script>
</body>
</html>
